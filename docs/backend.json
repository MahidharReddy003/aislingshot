{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Stores core profile information for a user, separate from authentication details, as authentication is handled by an external system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "The user's email address, primarily used for identification and communication.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the user profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "createdAt",
        "updatedAt"
      ]
    },
    "UserPreference": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserPreference",
      "type": "object",
      "description": "Stores personalized settings and default preferences for a user, directly influencing how recommendations are generated and presented.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserPreference entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:1 UserPreference)"
        },
        "defaultBudget": {
          "type": "number",
          "description": "The user's default budget preference for recommendations."
        },
        "defaultTimePreference": {
          "type": "string",
          "description": "The user's default time preference for activities (e.g., 'short', 'medium', 'long')."
        },
        "accessibilityNeeds": {
          "type": "array",
          "description": "A list of accessibility requirements specified by the user (e.g., 'wheelchair-accessible', 'visual-aid').",
          "items": {
            "type": "string"
          }
        },
        "discoveryLevel": {
          "type": "string",
          "description": "Controls the balance between familiar and new recommendations (e.g., 'familiar', 'explore', 'balanced')."
        },
        "emailNotificationsEnabled": {
          "type": "boolean",
          "description": "Indicates if the user wishes to receive email notifications."
        },
        "inAppNotificationsEnabled": {
          "type": "boolean",
          "description": "Indicates if the user wishes to receive in-app notifications."
        },
        "preferredCategoryIds": {
          "type": "array",
          "description": "References to Category IDs representing the user's preferred categories for recommendations. (Relationship: Category N:N UserPreference)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user preferences were created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the user preferences were last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "defaultBudget",
        "defaultTimePreference",
        "accessibilityNeeds",
        "discoveryLevel",
        "emailNotificationsEnabled",
        "inAppNotificationsEnabled",
        "createdAt",
        "updatedAt"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Defines different categories for recommendation items, allowing for structured organization and filtering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "The human-readable name of the category (e.g., 'Food', 'Travel', 'Campus Event', 'Product', 'Media Content', 'Creator Tool')."
        },
        "description": {
          "type": "string",
          "description": "A brief description explaining what this category represents."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "RecommendationItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RecommendationItem",
      "type": "object",
      "description": "Represents a distinct item, place, event, or content that can be recommended to users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RecommendationItem entity."
        },
        "name": {
          "type": "string",
          "description": "The primary name or title of the item."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the item, providing more context."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category, classifying the type of item. (Relationship: Category 1:N RecommendationItem)"
        },
        "estimatedCost": {
          "type": "number",
          "description": "The estimated cost associated with the item, if applicable (e.g., price of a product, cost of a trip)."
        },
        "estimatedTimeMinutes": {
          "type": "number",
          "description": "The estimated time in minutes required for or associated with the item, if applicable (e.g., duration of an event, reading time)."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image visually representing the item.",
          "format": "uri"
        },
        "location": {
          "type": "string",
          "description": "The physical or virtual location of the item, if applicable (e.g., 'Campus Canteen', 'Paris', 'Online Streaming Service')."
        },
        "isVegetarian": {
          "type": "boolean",
          "description": "Indicates if the item is vegetarian (primarily for food items)."
        },
        "isVegan": {
          "type": "boolean",
          "description": "Indicates if the item is vegan (primarily for food items)."
        },
        "isAccessible": {
          "type": "boolean",
          "description": "Indicates if the item or its physical location is accessible (e.g., wheelchair accessible)."
        },
        "averageRating": {
          "type": "number",
          "description": "The average rating of the item, if available, from external sources or user reviews."
        },
        "sourceUrl": {
          "type": "string",
          "description": "URL to the original source or a detailed information page about the item.",
          "format": "uri"
        },
        "tags": {
          "type": "array",
          "description": "A list of descriptive tags or keywords associated with the item for easier search and categorization.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "categoryId"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a single AI-generated recommendation provided to a user, including its context, explanation, and output metrics.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recommendation entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile, indicating which user received this recommendation. (Relationship: UserProfile 1:N Recommendation)"
        },
        "itemId": {
          "type": "string",
          "description": "Reference to RecommendationItem, indicating the specific item being recommended. (Relationship: RecommendationItem 1:N Recommendation)"
        },
        "recommendationType": {
          "type": "string",
          "description": "The type of experience that generated this recommendation (e.g., 'recommender', 'assistant', 'planner', 'creator')."
        },
        "inputParameters": {
          "type": "string",
          "description": "A JSON string representing the specific input controls and preferences (e.g., budget, time, accessibility toggle) that were active when this recommendation was generated. This is crucial for providing context to the 'Why This?' explanation."
        },
        "explanation": {
          "type": "string",
          "description": "The human-readable explanation generated by the AI, clarifying the reasoning behind the recommendation."
        },
        "costEstimate": {
          "type": "number",
          "description": "The estimated cost presented with this specific recommendation, potentially adjusted by AI logic."
        },
        "timeEstimateMinutes": {
          "type": "number",
          "description": "The estimated time in minutes presented with this specific recommendation, potentially adjusted by AI logic."
        },
        "diversityScore": {
          "type": "number",
          "description": "A score (0-100) indicating how diverse or novel this recommendation is compared to recent user choices, to combat filter bubbles."
        },
        "generatedAt": {
          "type": "string",
          "description": "Timestamp when this recommendation was generated.",
          "format": "date-time"
        },
        "alternativeSuggestionItemIds": {
          "type": "array",
          "description": "References to other RecommendationItem IDs that were offered as alternatives alongside this primary recommendation. (Relationship: RecommendationItem N:N Recommendation for alternatives)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "itemId",
        "recommendationType",
        "inputParameters",
        "explanation",
        "costEstimate",
        "timeEstimateMinutes",
        "diversityScore",
        "generatedAt"
      ]
    },
    "UserFeedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserFeedback",
      "type": "object",
      "description": "Records specific feedback provided by a user on a particular recommendation, enabling the feedback loop for AI improvement.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserFeedback entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N UserFeedback)"
        },
        "recommendationId": {
          "type": "string",
          "description": "Reference to Recommendation, indicating which recommendation received the feedback. (Relationship: Recommendation 1:N UserFeedback)"
        },
        "feedbackType": {
          "type": "string",
          "description": "The type of feedback provided by the user (e.g., 'relevant', 'not useful', 'too expensive', 'too repetitive')."
        },
        "comment": {
          "type": "string",
          "description": "An optional free-text comment provided by the user to elaborate on their feedback."
        },
        "submittedAt": {
          "type": "string",
          "description": "Timestamp when the feedback was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "recommendationId",
        "feedbackType",
        "submittedAt"
      ]
    },
    "SavedRecommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SavedRecommendation",
      "type": "object",
      "description": "Represents a recommendation that a user has explicitly saved or favorited for later access.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SavedRecommendation entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N SavedRecommendation)"
        },
        "recommendationId": {
          "type": "string",
          "description": "Reference to Recommendation, linking to the specific recommendation that was saved. (Relationship: Recommendation 1:N SavedRecommendation)"
        },
        "savedAt": {
          "type": "string",
          "description": "Timestamp when the recommendation was saved by the user.",
          "format": "date-time"
        },
        "collectionIds": {
          "type": "array",
          "description": "References to RecommendationCollection IDs this saved recommendation belongs to, allowing a saved item to be in multiple collections. (Relationship: RecommendationCollection N:N SavedRecommendation)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "recommendationId",
        "savedAt"
      ]
    },
    "RecommendationCollection": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RecommendationCollection",
      "type": "object",
      "description": "Allows users to organize their saved recommendations into custom, named collections.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RecommendationCollection entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N RecommendationCollection)"
        },
        "name": {
          "type": "string",
          "description": "The name of the collection (e.g., 'Weekend Trips', 'Favorite Restaurants', 'Campus Events')."
        },
        "description": {
          "type": "string",
          "description": "An optional, more detailed description for the collection."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the collection was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the collection was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "createdAt",
        "updatedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores core profile information for a user. The document ID for this path segment ({userId}) must match the 'id' field within the UserProfile document and `request.auth.uid`. It implicitly includes 'id' and 'email' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching `request.auth.uid`."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/preferences/{preferenceId}",
        "definition": {
          "entityName": "UserPreference",
          "schema": {
            "$ref": "#/backend/entities/UserPreference"
          },
          "description": "Stores personalized settings and preferences for a specific user. The 'userId' field within the document must match the '{userId}' path segment and `request.auth.uid` for authorization independence. A common pattern is to have a single document with a fixed ID like 'default' or 'current' under this path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching `request.auth.uid`."
            },
            {
              "name": "preferenceId",
              "description": "The unique ID of the user's preference document (e.g., 'default')."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Defines different public categories for recommendation items. This collection is globally accessible and read-only for all users.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique ID of the category."
            }
          ]
        }
      },
      {
        "path": "/recommendation_items/{itemId}",
        "definition": {
          "entityName": "RecommendationItem",
          "schema": {
            "$ref": "#/backend/entities/RecommendationItem"
          },
          "description": "Represents distinct items, places, events, or content that can be recommended. This collection is globally accessible and read-only for all users.",
          "params": [
            {
              "name": "itemId",
              "description": "The unique ID of the recommendation item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores individual AI-generated recommendations for a user. The 'userId' field within the document must match the '{userId}' path segment and `request.auth.uid` for authorization independence and QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching `request.auth.uid`."
            },
            {
              "name": "recommendationId",
              "description": "The unique ID of the specific recommendation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/feedback/{feedbackId}",
        "definition": {
          "entityName": "UserFeedback",
          "schema": {
            "$ref": "#/backend/entities/UserFeedback"
          },
          "description": "Records specific feedback provided by a user on a recommendation. The 'userId' field within the document must match the '{userId}' path segment and `request.auth.uid` for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching `request.auth.uid`."
            },
            {
              "name": "feedbackId",
              "description": "The unique ID of the user feedback entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/saved_recommendations/{savedRecommendationId}",
        "definition": {
          "entityName": "SavedRecommendation",
          "schema": {
            "$ref": "#/backend/entities/SavedRecommendation"
          },
          "description": "Represents a recommendation explicitly saved or favorited by a user. The 'userId' field within the document must match the '{userId}' path segment and `request.auth.uid` for authorization independence and QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching `request.auth.uid`."
            },
            {
              "name": "savedRecommendationId",
              "description": "The unique ID of the saved recommendation entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/collections/{collectionId}",
        "definition": {
          "entityName": "RecommendationCollection",
          "schema": {
            "$ref": "#/backend/entities/RecommendationCollection"
          },
          "description": "Allows users to organize their saved recommendations into custom, named collections. The 'userId' field within the document must match the '{userId}' path segment and `request.auth.uid` for authorization independence and QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching `request.auth.uid`."
            },
            {
              "name": "collectionId",
              "description": "The unique ID of the recommendation collection."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and debuggable by strictly adhering to the core design principles and strategy mandates. All user-specific data is encapsulated within a `/users/{userId}/` top-level collection, ensuring strong path-based authorization. Global, public data, such as `Category` and `RecommendationItem` definitions, resides in its own top-level collections (`/categories`, `/recommendation_items`), maintaining structural segregation and a uniform security posture (read-only public access).\n\n**Authorization Independence via Denormalization:**\nEach document within a user's subcollection (e.g., `UserProfile`, `UserPreference`, `Recommendation`, `UserFeedback`, `SavedRecommendation`, `RecommendationCollection`) explicitly includes a `userId` field that matches the `{userId}` segment in its path. For example, a `Recommendation` document at `/users/{userId}/recommendations/{recommendationId}` will have `resource.data.userId == userId`. This critical denormalization strategy eliminates the need for `get()` calls in Firestore Security Rules to check parent document ownership. Rules can evaluate `request.auth.uid == userId` and `resource.data.userId == request.auth.uid` locally within the document or path context, allowing for atomic operations (like creating a user's first preference document without first reading the user's profile) and greatly simplifying rule logic.\n\n**QAPs (Rules are not Filters) Support:**\nThis structure inherently supports Query-As-Permissions (QAPs). When a client requests a list of documents, for instance, all recommendations for the current user (`/users/{request.auth.uid}/recommendations`), the `request.auth.uid` is already part of the query path. The security rules will then simply verify that the requested `{userId}` path segment matches `request.auth.uid` and that the `userId` field within the document also matches. This ensures that users can only query their own data, preventing wide, unfiltered `list` operations that could expose sensitive information or be inefficient. Public collections (`/categories`, `/recommendation_items`) are designed for broad, read-only `list` access by all authenticated users, with no filtering required.\n\n**Clarity of Intent and Debuggability:**\nBy segregating data into explicit user-owned paths and global public paths, the authorization intent is immediately clear. Rules for `/users/{userId}/...` paths will consistently enforce ownership, while rules for `/categories` or `/recommendation_items` will consistently allow public reads. This radical consistency and predictable schema (e.g., always including `userId` for user-owned data) makes security rules simpler to write, easier to audit, and much more straightforward to debug."
  }
}